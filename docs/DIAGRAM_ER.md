# Diagrama Entidad-RelaciÃ³n

## Diagrama Visual

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TEMPLATES                             â”‚
â”‚                    (Tabla Principal)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚ id (PK)     â”‚  INT, AUTO_INCREMENT                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚ product                 â”‚  VARCHAR(100), NOT NULL          â”‚
â”‚  â”‚ endorseType             â”‚  VARCHAR(100), NOT NULL          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚         â”‚                                                     â”‚
â”‚         â””â”€â”€â”€ UNIQUE(product, endorseType)                    â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚ dynamicDataConfig       â”‚  JSONB, NOT NULL                 â”‚
â”‚  â”‚                         â”‚                                 â”‚
â”‚  â”‚ [                       â”‚                                 â”‚
â”‚  â”‚   {                     â”‚                                 â”‚
â”‚  â”‚     "label": "...",     â”‚                                 â”‚
â”‚  â”‚     "sourceField": "...",â”‚                                â”‚
â”‚  â”‚     "required": true,   â”‚                                 â”‚
â”‚  â”‚     "defaultValue": ""  â”‚                                 â”‚
â”‚  â”‚   }                     â”‚                                 â”‚
â”‚  â”‚ ]                       â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚ eventAppliedEntitiesConfigâ”‚ JSONB, NOT NULL               â”‚
â”‚  â”‚                         â”‚                                 â”‚
â”‚  â”‚ [                       â”‚                                 â”‚
â”‚  â”‚   {                     â”‚                                 â”‚
â”‚  â”‚     "description": "...",â”‚                               â”‚
â”‚  â”‚     "orderEvent": 1     â”‚                                 â”‚
â”‚  â”‚   }                     â”‚                                 â”‚
â”‚  â”‚ ]                       â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚ defaultValues           â”‚  JSONB, NULL                    â”‚
â”‚  â”‚                         â”‚                                 â”‚
â”‚  â”‚ {                       â”‚                                 â”‚
â”‚  â”‚   "eventDescription": "...",â”‚                            â”‚
â”‚  â”‚   "moneda": "...",      â”‚                                 â”‚
â”‚  â”‚   "producto": "..."     â”‚                                 â”‚
â”‚  â”‚ }                       â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ status      â”‚  â”‚ createdAt    â”‚  â”‚ updatedAt    â”‚         â”‚
â”‚  â”‚ VARCHAR(50) â”‚  â”‚ TIMESTAMP    â”‚  â”‚ TIMESTAMP    â”‚         â”‚
â”‚  â”‚ DEFAULT     â”‚  â”‚ AUTO         â”‚  â”‚ AUTO UPDATE  â”‚         â”‚
â”‚  â”‚ 'active'    â”‚  â”‚              â”‚  â”‚              â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                         â”‚
        â–¼                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   INDEX       â”‚                      â”‚   INDEX       â”‚
â”‚ (product,     â”‚                      â”‚ (status)      â”‚
â”‚  endorseType) â”‚                      â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Relaciones

### RelaciÃ³n: Producto â†” Tipo de Endoso

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PRODUCT    â”‚ 1    N  â”‚ ENDORSE_TYPE â”‚
â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  - Rumbo     â”‚         â”‚ - CambioFrecuenciaâ”‚
â”‚  - Otro      â”‚         â”‚ - OtroTipo   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   TEMPLATE   â”‚
         â”‚  (1 por cada â”‚
         â”‚  combinaciÃ³n)â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Cardinalidad**: 1:N (Un producto puede tener mÃºltiples tipos de endoso, y cada combinaciÃ³n tiene una plantilla Ãºnica)

## Estructura de Datos JSONB

### dynamicDataConfig

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     dynamicDataConfig (JSONB)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Array de objetos:                      â”‚
â”‚                                         â”‚
â”‚ [                                       â”‚
â”‚   {                                     â”‚
â”‚     label: "ProductosVida"             â”‚
â”‚     sourceField: "producto"             â”‚
â”‚     required: true                      â”‚
â”‚     defaultValue: ""                     â”‚
â”‚   },                                    â”‚
â”‚   {                                     â”‚
â”‚     label: "NombreUsuario"              â”‚
â”‚     sourceField: "usuario"              â”‚
â”‚     required: false                     â”‚
â”‚     defaultValue: ""                     â”‚
â”‚   }                                     â”‚
â”‚ ]                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### eventAppliedEntitiesConfig

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ eventAppliedEntitiesConfig (JSONB)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Array de objetos ordenados:            â”‚
â”‚                                         â”‚
â”‚ [                                       â”‚
â”‚   {                                     â”‚
â”‚     description: "SolicitarEndoso"     â”‚
â”‚     orderEvent: 1                       â”‚
â”‚   },                                    â”‚
â”‚   {                                     â”‚
â”‚     description: "AprobarEndoso"        â”‚
â”‚     orderEvent: 2                       â”‚
â”‚   }                                     â”‚
â”‚ ]                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### defaultValues

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        defaultValues (JSONB)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Objeto con valores por defecto:        â”‚
â”‚                                         â”‚
â”‚ {                                       â”‚
â”‚   eventDescription: "SolicitarEndoso"  â”‚
â”‚   moneda: "Nuevo Sol"                   â”‚
â”‚   producto: "Rumbo"                     â”‚
â”‚   plan: "PlanRumbo"                     â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ejemplo de Datos

### Registro Ejemplo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id: 1                                                       â”‚
â”‚ product: "Rumbo"                                            â”‚
â”‚ endorseType: "CambioFrecuencia"                              â”‚
â”‚                                                             â”‚
â”‚ dynamicDataConfig:                                          â”‚
â”‚   [                                                         â”‚
â”‚     {label: "ProductosVida", sourceField: "producto", ...}, â”‚
â”‚     {label: "NombreUsuario", sourceField: "usuario", ...}  â”‚
â”‚   ]                                                         â”‚
â”‚                                                             â”‚
â”‚ eventAppliedEntitiesConfig:                                â”‚
â”‚   [                                                         â”‚
â”‚     {description: "SolicitarEndoso", orderEvent: 1},        â”‚
â”‚     {description: "AprobarEndoso", orderEvent: 2}          â”‚
â”‚   ]                                                         â”‚
â”‚                                                             â”‚
â”‚ defaultValues:                                             â”‚
â”‚   {                                                         â”‚
â”‚     eventDescription: "SolicitarEndoso",                   â”‚
â”‚     moneda: "Nuevo Sol"                                     â”‚
â”‚   }                                                         â”‚
â”‚                                                             â”‚
â”‚ status: "active"                                            â”‚
â”‚ createdAt: 2025-01-27 10:00:00                             â”‚
â”‚ updatedAt: 2025-01-27 10:00:00                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ãndices y OptimizaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ÃNDICES                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ PRIMARY KEY:                            â”‚
â”‚   â””â”€ id                                 â”‚
â”‚                                         â”‚
â”‚ UNIQUE:                                 â”‚
â”‚   â””â”€ (product, endorseType)            â”‚
â”‚                                         â”‚
â”‚ INDEX (B-Tree):                         â”‚
â”‚   â”œâ”€ (product, endorseType)             â”‚
â”‚   â””â”€ (status)                           â”‚
â”‚                                         â”‚
â”‚ GIN INDEX (para JSONB):                 â”‚
â”‚   â””â”€ dynamicDataConfig (opcional)       â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flujo de Consulta

```
1. Request: product="Rumbo", endorseType="CambioFrecuencia"
                    â”‚
                    â–¼
2. BÃºsqueda en Ã­ndice (product, endorseType)
                    â”‚
                    â–¼
3. Retorna Template con configuraciÃ³n JSONB
                    â”‚
                    â–¼
4. Parseo de JSONB en aplicaciÃ³n
                    â”‚
                    â–¼
5. Uso de configuraciÃ³n para transformar JSON
```

## Consideraciones de DiseÃ±o

### Ventajas

âœ… **NormalizaciÃ³n**: Una sola tabla para todas las configuraciones
âœ… **Flexibilidad**: JSONB permite estructuras dinÃ¡micas
âœ… **Performance**: Ãndices optimizan bÃºsquedas frecuentes
âœ… **Extensibilidad**: Agregar campos sin ALTER TABLE

### Limitaciones

âš ï¸ **ValidaciÃ³n**: JSONB no valida estructura automÃ¡ticamente
âš ï¸ **Consultas**: Consultas complejas en JSONB pueden ser lentas
âš ï¸ **Versionado**: No hay historial de cambios automÃ¡tico

### Mejoras Futuras

ğŸ”® **Versionado**: Agregar tabla `template_versions`
ğŸ”® **AuditorÃ­a**: Tabla `template_audit_log`
ğŸ”® **ValidaciÃ³n**: Constraints CHECK para validar JSONB
ğŸ”® **Cache**: Redis para plantillas activas



